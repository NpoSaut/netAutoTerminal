#Запуск программы
##Обычный запуск
При обычном запуске программа предложит пользователю выбрать один из последних использовавшихся проектов, либо вручную выбрать файл проекта с диска. Возможности создания проекта в текущей версии программы не предусмотрено. Корневой директорией при этом будет считаться папка, в которой находился загруженный .fpc-файл.

##Ассоциации с файлами
Программу можно проассоциировать с файлами типа `.fpc` обычными средствами опреационной системы (меню "Открыть с помощью..."), либо открывать проекты при помощи перетаскивания файла проекта на ярлык программы FmPack. Корневой директорией при этом будет считаться папка, в которой находился загруженный .fpc-файл.

##Запуск из командной строки
Для обеспечения возможности автоматической или полуавтоматической упаковки прошивок, программа FmPack поддерживает запуск с передачей параметров из командной строки. Таким образом, создание .sfp-файла можно включить в события пост-компиляции в среде разработки или в состав bat-скрипта.

Все указанные в командной строке параметры будут подставлены в соответствующие поля формы. Если указать все необходимые параметры в командной строке, можно запустить FmPack в скрытом режиме. Тогда программа создаст .sfp файл, не показывая дополнительных окон.

При запуске программы из командной строки можно использовать строку следующего вида:

`FmPack.exe <Путь в проектному файлу> <Путь к выходному файлу, можно использовать {...}> <Параметры>`

В пути к .sfp файлу (в том числе вместо имён папок) можно использовать следующие переменные:
 * `{version-major}` - версия
 * `{version-minor}` - подверсия
 * `{version-label}` - текстовая метка
 * `{release-date}` - дата выпуска
 * `{version}` - версия в формате "версия.подверсия"
 * `{cell}` - название ячейки
 * `{module}` - название програмного модуля
 * `{modification}` - название модификации

Параметры:
 * `-version-major=` версия
 * `-version-minor=` подверсия
 * `-version-label=` текстовая метка
 * `-release-date=` дата в формате ДД.ММ.ГГГГ (или `today` для текущей даты)
 * `-root=` корневая папка при сборке проекта (от неё будут отсчитываться все пути к файлам). По-умолчанию - *текущая директория*.
 * `-silent` запуск программы в скрытом режиме

Пример строки запуска:

`FmPack.exe "project 1.fpc" "{cell} (версия {version}).sfp" -root="c:\firmware\bin" -version-major=1 -version-minor=15 -release-date=today`

#Создание проектного файла
Программа FmPack создаёт файл прошивки (.sfp), руководствуясь проектным файлом (.fpc). Проектный файл представляет собой XML-файл с объявлением структуры и целей будущего файла прошивки. Создать его необходимо вручную в любом текстовом редакторе.

##Структура проектного файла
Пример файла проекта:
```
<Package>
	<Component>
		<Target Cell="20" Modification="1" Module="1" Channel="1" />
		<Target Cell="20" Modification="2" Module="1" Channel="1" />
		<Files>
			<MapFile From="release\binary1.bin" To="f/0" />
			<MapFolder From="release\commons\" Pattern="*.dll" To="f/" />
		</Files>
	</Component>
	<Component>
		<Target Cell="20" Modification="1" Module="1" Channel="2" />
		<Target Cell="20" Modification="2" Module="1" Channel="2" />
		<Files>
			<MapFile From="release\binary2.bin" To="f/0" />
			<MapFolder From="release\commons" Pattern="*.dll" To="f/" />
		</Files>
	</Component>
</Package>
```

Корневым элементом проектного файла является элемент `Package`, содержащий по элементу `Component` для каждого компонетна прошивки.

Компонент прошивки - независимый набор файлов, который будет скопирован на устройство. Пакет прошивки чаще всего состоит из одного компонента, однако может содержать и несколько (например, если необходимо использовать разные бинарники для разных полукомплектов или модификаций устройства).

Элемент `Component` содержит список целей (элементы `Target`), для которых применим этот компонент (одну или несколько). Идентификаторы для целей можно узнать в [каталоге ячеек](https://github.com/NpoSaut/netFirmwarePacking/blob/master/BlockKinds.xml).
Так же элемент `Component` содержит элемент `Files` со списком маппингов файлов.

##Маппинг файлов
Маппинги файлов позволяют производить операции переименования файлов в момент их добавления в пакет. Это может оказаться полезным для создания пакетов для микроконтроллеров, а так же при создании пакетов для устройств, имеющих разные модификации (можно для разных пакетов или компонентов мапить разные выходные файлы).
На данный момент существуют два типа маппингов:
 * `MapFile` включает в проект один файл, указанный в атрибуте `From`, помещая его в пакет с именем, указанным в атрибуте `To`.
 * `MapFolder` помещает содержимое папки, указанной в атрибуте `From` в папку, указанную в атрибуте `To`. Можно указать маску для копирования файлов в атрибуте `Pattern`.

Компонент может содержать любое количество маппингов в любой комбинации.

Все пути, указанные в атрибутах `From` отсчитываются относительно *корневой папки проекта*. Корневая папка проекта зависит от способа запуска программы.
Пути, указанные в атрибутах `To` отсчитываются от корня прошивки.
